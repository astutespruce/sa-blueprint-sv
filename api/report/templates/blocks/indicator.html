<div class="indicator">

<div class="no-break">
    <h3 class="indicator-header">{{indicator.label}}</h3>

    <p>{{indicator.description}}</p>

    {% if maps[indicator_id] %}
        <div class="map-container">
            <img src="data:image/png;base64,{{maps[indicator_id]}}" alt="Map for {{indicator.label}}" class="map">

            {% include "elements/map_footer.html" %}
        </div>

        <div class="flex map-footer">
            <div class="map-locator-container">
                {% if maps.locator %}
                    <img src="data:image/png;base64,{{maps.locator}}" alt="Locator map" class="map-locator">
                {% else %}
                    <div class="map-locator-placeholder text-center">
                        map could not be created
                    </div>
                {% endif %}
            </div>

            <div class="legend">
                {% for item in legends[indicator_id] %}
                    <div class="legend-element flex align-center">
                        <div class="legend-patch" style="background: {{item.color}}"></div>
                        <div class="legend-label">{{item.label}}</div>
                    </div>
                {% endfor %}
                <!-- space is required or last label doesn't render -->
                &nbsp;
            </div>
        </div>

    {% else %}
        <div class="map-placeholder text-center">
            map could not be created
        </div>
    {% endif %}

</div>


<div class="no-break">

    <div class="caption">
        Table {{table.counter}}: {{indicator.caption}}
    </div>
    {% set table.counter=table.counter+1 %}

    <!-- all indicators are presented in descending order -->
    <!-- use sum of area in regionwide indicators -->
    {% with acres=results[indicator_id][::-1],entries=indicator['values'].items()|reverse,total_acres=results[indicator_id]|sum,has_good_threshold=indicator.goodThreshold,min_value=indicator['values'].keys()|min %}

    {% if has_good_threshold %}
        <table class="centered">
            <thead>
                <tr>
                    <th class="level"></th>
                    <th class="label">Indicator Values</th>
                    <th class="acres">Acres</th>
                    <!-- <th class="percent">Percent of {{ecosystem.label|lower}} ecosystem</th> -->
                    <th class="percent">Percent of indicator area</th>
                    <th class="threshold"></th>
                </tr>
            </thead>
            <tbody>
                {% for value, label in entries %}
                    <tr class="{%if value == indicator.goodThreshold %}above-threshold{% endif %}">
                        <td class="level no-border">
                            {% if loop.first %}
                                &uarr; High
                            {% elif loop.last %}
                                &darr; Low
                            {% endif %}
                        </td>

                        <td class="label">{{label}}</td>
                        <td class="acres">{{acres[loop.index-1]|format_number}}</td>
                        <td class="percent">{{(100 * acres[loop.index-1] / total_acres)|format_number}}%</td>

                        {% if loop.first %}
                            <td class="threshold good" rowspan="{{((entries|length) - indicator.goodThreshold) + min_value}}">
                                &uarr; In good condition
                            </td>
                        {% elif value == indicator.goodThreshold - 1 %}
                            <td class="threshold not-good" rowspan="{{indicator.goodThreshold}}">
                                &darr; Not in good condition
                            </td>
                        {% endif %}
                    </tr>
                {% endfor %}

                <tr class="total-row">
                    <td class="no-border no-background"></td>
                    <td class="label align-right">Total indicator area</td>
                    <td class="acres">{{total_acres|format_number}}</td>
                    <td class="percent">100%</td>
                </tr>
            </tbody>
        </table>

        {% else %}

        <table class="centered">
            <thead>
                <tr>
                    <th class="level"></th>
                    <th class="label">Indicator Values</th>
                    <th class="acres">Acres</th>
                    <!-- <th class="percent">Percent of {{ecosystem.label|lower}} ecosystem</th> -->
                    <th class="percent">Percent of indicator area</th>
                </tr>
            </thead>
            <tbody>
                {% for value, label in entries %}
                    <tr>
                        <td class="level no-border">
                            {% if loop.first %}
                                &uarr; High
                            {% elif loop.last %}
                                &darr; Low
                            {% endif %}
                        </td>
                        <td class="label">{{label}}</td>
                        <td class="acres">{{acres[loop.index-1]|format_number}}</td>
                        <td class="percent">{{(100 * acres[loop.index-1] / total_acres)|format_number}}%</td>
                    </tr>
                {% endfor %}

                <tr class="total-row">
                    <td class="no-border no-background"></td>
                    <td class="align-right">Total indicator area</td>
                    <td class="acres">{{total_acres|format_number}}</td>
                    <td class="percent">100%</td>
                </tr>
            </tbody>
        </table>

        {% endif %}
    {% endwith %}
</div>

</div>